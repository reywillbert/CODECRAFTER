<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GitHub PDF Uploader + Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; max-width: 780px; margin: 2rem auto; padding: 0 1rem; }
    h1 { font-size: 1.6rem; }
    fieldset { border: 1px solid #ddd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; }
    label { display: block; margin: 0.5rem 0 0.25rem; font-weight: 600; }
    input, button { width: 100%; padding: 0.6rem; margin-bottom: 0.75rem; }
    input[type="file"] { padding: 0.3rem; }
    button { cursor: pointer; background: #24292f; color: white; border: none; border-radius: 6px; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .status { margin-top: 1rem; padding: 0.75rem; border-radius: 6px; }
    .status.ok { background: #e6ffed; color: #0f5132; border: 1px solid #b7ebc6; }
    .status.err { background: #ffe6e6; color: #842029; border: 1px solid #f5b5b5; }
    ul { list-style: none; padding: 0; }
    li { margin: 0.4rem 0; }
    a { color: #0969da; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Upload & Search PDFs in GitHub</h1>

  <!-- Upload form -->
  <form id="uploadForm">
    <fieldset>
      <legend>Repository settings</legend>
      <label>Owner <input id="owner" required /></label>
      <label>Repo <input id="repo" required /></label>
      <label>Branch <input id="branch" value="main" required /></label>
      <label>Folder (optional) <input id="folder" /></label>
      <label>Token <input id="token" type="password" required /></label>
    </fieldset>

    <fieldset>
      <legend>Upload PDF</legend>
      <label>Choose PDF <input id="file" type="file" accept="application/pdf" required /></label>
      <label>Commit message <input id="message" value="Add PDF" required /></label>
    </fieldset>

    <button type="submit" id="submitBtn">Upload to GitHub</button>
  </form>

  <div id="status" class="status" style="display:none;"></div>

  <!-- Search section -->
  <fieldset>
    <legend>Search PDFs</legend>
    <label>Search by name <input id="searchInput" placeholder="Type to filter PDFs..." /></label>
    <button type="button" id="loadBtn">Load PDFs from Repo</button>
    <ul id="pdfList"></ul>
  </fieldset>

  <script>
    const statusBox = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');

    function showStatus(msg, ok=false) {
      statusBox.textContent = msg;
      statusBox.className = 'status ' + (ok ? 'ok' : 'err');
      statusBox.style.display = 'block';
    }

    async function fileToBase64(file) {
      const arrayBuffer = await file.arrayBuffer();
      let binary = '';
      const bytes = new Uint8Array(arrayBuffer);
      for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
      return btoa(binary);
    }

    async function putFile({owner, repo, path, branch, message, base64, token}) {
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      const res = await fetch(url, {
        method: 'PUT',
        headers: { 'Authorization': `Bearer ${token}`, 'Accept': 'application/vnd.github+json' },
        body: JSON.stringify({ message, content: base64, branch })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'Upload failed');
      return data;
    }

    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const owner = owner.value.trim();
      const repo = repo.value.trim();
      const branch = branch.value.trim();
      const folder = folder.value.trim();
      const token = token.value.trim();
      const file = document.getElementById('file').files[0];
      const message = message.value.trim();

      if (!file) return showStatus('No file selected');
      if (file.type !== 'application/pdf') return showStatus('Not a PDF');

      submitBtn.disabled = true;
      submitBtn.textContent = 'Uploadingâ€¦';

      try {
        const base64 = await fileToBase64(file);
        const path = (folder ? folder + '/' : '') + file.name;
        await putFile({owner, repo, path, branch, message, base64, token});
        showStatus('Uploaded successfully!', true);
      } catch (err) {
        showStatus('Error: ' + err.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Upload to GitHub';
      }
    });

    // --- Search functionality ---
    const loadBtn = document.getElementById('loadBtn');
    const searchInput = document.getElementById('searchInput');
    const pdfList = document.getElementById('pdfList');

    async function loadPDFs() {
      pdfList.innerHTML = '';
      const ownerVal = owner.value.trim();
      const repoVal = repo.value.trim();
      const folderVal = folder.value.trim();
      const tokenVal = token.value.trim();
      const url = `https://api.github.com/repos/${ownerVal}/${repoVal}/contents/${folderVal || ''}`;
      const res = await fetch(url, { headers: { 'Authorization': `Bearer ${tokenVal}` } });
      const data = await res.json();
      if (!res.ok) return showStatus('Error loading files: ' + data.message);
      const pdfs = data.filter(f => f.name.toLowerCase().endsWith('.pdf'));
      pdfs.forEach(f => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = f.html_url;
        a.textContent = f.name;
        a.target = '_blank';
        li.appendChild(a);
        pdfList.appendChild(li);
      });
    }

    loadBtn.addEventListener('click', loadPDFs);

    searchInput.addEventListener('input', () => {
      const term = searchInput.value.toLowerCase();
      [...pdfList.children].forEach(li => {
        li.style.display = li.textContent.toLowerCase().includes(term) ? '' : 'none';
      });
    });
  </script>
</body>
</html>
